@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="pt-br">


<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta http-equiv="content-language" content="pt-br" />
    <meta name="robots" content="index, follow" />
    <link rel="stylesheet" type="text/css" href="~/CadC/css/reset.css">
    <link rel="stylesheet" type="text/css" href="~/CadC/css/style.css">
    <link rel="stylesheet" type="text/css" href="~/CadC/css/fonts-icones.css">
    <link rel="icon" type="image/x-icon" href="~/iconHarry.png" sizes="32x32" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <title>Compra - Ingresso</title>

</head>

<style>
    body{text-align: center; padding-top: 50px}

    .estrelas input[type=radio] {
      display: none;
    }
    .estrelas label i.fa{
      font-size: 2.5em
    }
    .estrelas label i.fa:before {
      content:'\f005';
      color: #FC0;
    }
    .estrelas input[type=radio]:checked ~ label i.fa:before {
      color: #CCC;
    }
</style>

<body>

    <header class="main_header container">
        <div class="content">

            <div class="main_header_logo">
                <img src="~/imagens/rick.svg" title="CinEXame" />
            </div>

        </div>
    </header>

    <main class="main_content container">


        <section class="section-seu-codigo container">

            <div class="content">



                <!--Inícia Formulário-->

                <div class="container_form">
                    <div class="box-artigo">
                        <h1 style="text-align:center; color:black">O que achou desse filme?</h1>


                        <form class="form" action="#" method="post">
                            <div id="divCadastro" class="esconder">

                                <div class="col-md-12 mb-3 text-center" style="text-align:center; margin-bottom: 10px">

                                    <img src="" id="imagemFilme" width="350" align="middle" />

                                </div>

                                <div class="col-12 mb-3">
                                    <input id="txtCodigo" type="hidden" />
                                    <label>Filme: </label>
                                    <input id="txtNome" type="text" class="form-control" placeholder="Nome" style="background-color:#A3A3CD; border-radius: 10px; " readonly />
                                </div>
                                <br />
                                <h1 style="text-align:center; color:black">Avalie abaixo:</h1>
                                <div class="col-12 mb-3">
                                    <label>Fale do filme: </label>
                                    <textarea id="txtOpiniao" type="text" class="form-control" placeholder="Nos conte o que achou!" style="background-color:transparent; border-radius: 10px; color:black" required>
                                    </textarea>
                                </div>
                                <div class="col-12 mb-3">
                                    <h2 style="margin:2%; text-align:center"> Dê sua opinão(1 a 5)!</h2>
                                    <div class="estrelas">
                                        <input type="radio" id="cm_star-empty" name="fb" value="" checked />
                                        <label for="cm_star-1"><i class="fa"></i></label>
                                        <input type="radio" id="cm_star-1" name="fb" value="1" />
                                        <label for="cm_star-2"><i class="fa"></i></label>
                                        <input type="radio" id="cm_star-2" name="fb" value="2" />
                                        <label for="cm_star-3"><i class="fa"></i></label>
                                        <input type="radio" id="cm_star-3" name="fb" value="3" />
                                        <label for="cm_star-4"><i class="fa"></i></label>
                                        <input type="radio" id="cm_star-4" name="fb" value="4" />
                                        <label for="cm_star-5"><i class="fa"></i></label>
                                        <input type="radio" id="cm_star-5" name="fb" value="5" />
                                    </div>
                                </div>
                                <br />
                                <br />
                                <div class="form_grupo">
                                    <button id="btnSalvar" style="margin-left: 26%" type="button" class="submit_btn">Enviar Avaliação</button>
                                    <button id="btnVoltar" style="margin-left: 35%" type="button" class="submit_btn"><a asp-controller="Home" asp-action="Index" style="color:white; text-decoration:none;">Voltar</a></button>
                                </div>

                            </div>




                        </form>

                    </div><!--container_form-->
                    <!--Finaliza Formulário-->


                </div><!--Box Artigo-->


                <div class="clear"></div>
            </div>
        </section><!--FECHA BOX HTML-->


    </main>

    <footer class="main_footer container">
        <div class="main_footer_copy">

            <p class="m-b-footer"> CinEXame - 2022, Todos os direitos reservados.</p>
            <p class="by"><i class="icon icon-heart-3"></i> Desenvolvido por: Adrian Silva</p>

        </div>
    </footer>

    <script src="~/CadC/js/jquery.js"></script>
    <script src="~/CadC/js/script.js"></script>


</body>
</html>


<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="@(Url.Content("https://cdn.jsdelivr.net/npm/cleave.js@1.6.0/dist/cleave.min.js"))" type="text/javascript"></script>


<script>
    const urlParams = new URLSearchParams(window.location.search);
    var url = 'https://localhost:44383/api/';
    var urlImagem = 'https://localhost:44383/api/Filme/obterimagem?arquivo=';
    var imagemSelecionada = '';

    function carregarImagem() {
        $('#imagemFilme').val('');
        $('#imagemFilme').attr('src', urlImagem + imagemSelecionada);
    }

    function inserir(id) {
        var codigo = $('#txtCodigo').val();
        codigo = 0;
        var teste = false;
        var value = 0;
        const checkstar = document.getElementById("cm_star-empty");
        const checkstar1 = document.getElementById("cm_star-1");
        const checkstar2 = document.getElementById("cm_star-2");
        const checkstar3 = document.getElementById("cm_star-3");
        const checkstar4 = document.getElementById("cm_star-4");
        const checkstar5 = document.getElementById("cm_star-5");
        if (checkstar1.checked == true) {
            teste = true;
            value = 1;
        } else if (checkstar2.checked == true) {
            teste = true;
            value = 2;
        } else if (checkstar3.checked == true) {
            teste = true;
            value = 3;
        } else if (checkstar4.checked == true) {
            teste = true;
            value = 4;
        } else if (checkstar5.checked == true) {
            teste = true;
            value = 5;
        } else {
            teste = false;
            value = 0;
        }
        var opiniao = $('#txtOpiniao').val().toString();
        var cliente = sessionStorage.getItem('IdCliente');
        console.log(teste);
        console.log(value);
        console.log(opiniao);
        console.log(codigo);
        console.log(cliente);
        if (value > 0 && codigo == 0) {
            var obj = {
                Avaliacao1: opiniao,
                Id: parseInt(codigo),
                IdFilme: parseInt(id),
                IdCliente: parseInt(cliente),                
                TotalAvaliacao: parseInt(value),
            };
            console.log(obj);
            $.ajax({
                type: "PUT",
                url: url + 'Avaliacao/salvar',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify(obj),
                success: function(jsonResult) {

                    console.log('metodo post: ', jsonResult);

                    if (jsonResult.status) {
                        alert("Avaliação salva com sucesso!!");
                        window.location.href = "../Login/HomeLogin";
                    }else{
                        alert("Erro ao salvar Avaliação!");
                    }

                },
                failure: function(response) {
                    alert("Erro ao carregar os dados: " + response);
                }
            });

        }else if(value <= 0){
            alert("Favor avaliar com pelo menos 1 estrela caso não tenha de fato gostado!");
        }else{
            alert("Erro");
        }


    }

    function recuperarFilme(id) {


        $.ajax({
            type: "GET",
            url: url + 'Filme/recuperar?id=' + id,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(jsonResult) {

                if (jsonResult.status) {

                    console.log(jsonResult);


                    var obj = jsonResult.resultado;


                    imagemSelecionada = obj.imagem;
                    carregarImagem();
                    $('#txtNome').val(obj.nome);



                }

            },
            failure: function(response) {
                alert("Erro ao carregar os dados: " + response);
            }
        });

    }





    $(function() {

        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get("id");
        recuperarFilme(id);
        $('#btnSalvar').click(function() { inserir(id); });


    });

</script>